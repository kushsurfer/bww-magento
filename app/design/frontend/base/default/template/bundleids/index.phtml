<?php
 
 	if(!isset($_GET['prodID'])){
 		header("Location: ". Mage::getBaseUrl());
		die();
 	
 	} else {
	 	$prodID = $_GET['prodID'];
		$bundled_product = new Mage_Catalog_Model_Product();		
		$bundled_product->load($prodID);
	 	
	 	$typeInstance = $bundled_product->getTypeInstance(true);

		$selectionCollection = $typeInstance->getSelectionsCollection(
			$typeInstance->getOptionsIds($bundled_product), $bundled_product
		);

	 	
	 	$optionCollection = $typeInstance->getOptionsCollection($bundled_product);

 		$_options = $optionCollection->appendSelections($selectionCollection, false,
                Mage::helper('catalog/product')->getSkipSaleableCheck()
                );

        $bundle_option = array();

        foreach ($_options as $key => $value) {
        	$defaultTitle = $value->getData('default_title');
        	$defaultTitle = str_replace(" ", "_", $defaultTitle);

			$option_id = $value->getData('option_id');

			$bundled_items[$defaultTitle]['option_id'] = $option_id;

            foreach ($value['selections'] as $selKey => $selection) {

            	$selection = $selection->getData();

                $bundled_items[$defaultTitle]['prodIDs'][$selection['product_id']] = $selection['selection_id'];
              
            }
            
        }
	 
		// print_r($bundled_items);
		// echo '<br/><br/><br/>';
		echo json_encode($bundled_items);
	}
 
?>